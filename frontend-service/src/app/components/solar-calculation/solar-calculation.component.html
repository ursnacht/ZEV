<div class="zev-container">
  <h1>{{ 'SOLAR_DISTRIBUTION_BERECHNUNG' | translate }}</h1>

  @if (message) {
    <div class="zev-message" [ngClass]="'zev-message--' + messageType">
      {{ message }}
    </div>
  }

  <form (ngSubmit)="onSubmit()">
    <app-quarter-selector
      [selectedVon]="dateFrom"
      [selectedBis]="dateTo"
      (quarterSelected)="onQuarterSelected($event)">
    </app-quarter-selector>

    <div class="zev-date-range-row">
      <div class="zev-form-group">
        <label for="dateFrom">{{ 'VON_DATUM' | translate }}:</label>
        <input type="date" id="dateFrom" class="zev-input" name="dateFrom" [(ngModel)]="dateFrom"
          (ngModelChange)="onDateFromChange()" required>
      </div>

      <div class="zev-form-group">
        <label for="dateTo">{{ 'BIS_DATUM' | translate }}:</label>
        <input type="date" id="dateTo" class="zev-input" name="dateTo" [(ngModel)]="dateTo" required>
      </div>

      <div class="zev-button-group">
        <button type="submit" class="zev-button zev-button--primary" [disabled]="calculating || !dateFrom || !dateTo">
          {{ calculating ? ('BERECHNUNG_LAEUFT' | translate) : ('BERECHNEN' | translate) }}
        </button>
      </div>
    </div>

    <div class="zev-form-group">
      <label>{{ 'ALGORITHMUS' | translate }}:</label>
      <div class="algorithm-selection">
        <label class="radio-label">
          <input type="radio" name="algorithm" value="EQUAL_SHARE" [(ngModel)]="algorithm">
          {{ 'ALGORITHMUS_EQUAL_SHARE' | translate }}
        </label>
        <label class="radio-label">
          <input type="radio" name="algorithm" value="PROPORTIONAL" [(ngModel)]="algorithm">
          {{ 'ALGORITHMUS_PROPORTIONAL' | translate }}
        </label>
      </div>
    </div>
  </form>

  @if (result) {
    <div class="result-summary">
      <h2>{{ 'ZUSAMMENFASSUNG' | translate }}</h2>
      <div class="summary-grid">
        <div class="summary-item">
          <span class="label">{{ 'VERWENDETER_ALGORITHMUS' | translate }}:</span>
          <span class="value">{{ result.algorithm === 'PROPORTIONAL' ? ('ALGORITHMUS_PROPORTIONAL' | translate) :
          ('ALGORITHMUS_EQUAL_SHARE' | translate) }}</span>
        </div>
        <div class="summary-item">
          <span class="label">{{ 'ZEITBEREICH' | translate }}:</span>
          <span class="value">{{ result.dateFrom | swissDate }} - {{ result.dateTo | swissDate }}</span>
        </div>
        <div class="summary-item">
          <span class="label">{{ 'VERARBEITETE_ZEITSTEMPEL' | translate }}:</span>
          <span class="value">{{ result.processedTimestamps }}</span>
        </div>
        <div class="summary-item">
          <span class="label">{{ 'VERARBEITETE_EINTRAEGE' | translate }}:</span>
          <span class="value">{{ result.processedRecords }}</span>
        </div>
        <div class="summary-item">
          <span class="label">{{ 'GESAMT_SOLAR_PRODUKTION' | translate }}:</span>
          <span class="value">{{ result.totalSolarProduced | number:'1.2-2' }} kWh</span>
        </div>
        <div class="summary-item">
          <span class="label">{{ 'GESAMT_VERTEILT' | translate }}:</span>
          <span class="value">{{ result.totalDistributed | number:'1.2-2' }} kWh</span>
        </div>
      </div>
    </div>
  }
</div>